<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Wikitude SDK iOS 5.3.0 Documentation</title>
    <link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:300,400,700">

    <link type="text/css" rel="stylesheet" href="css/reset.css">
    <link type="text/css" rel="stylesheet" href="css/docs.css">
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print">
    <link type="text/css" rel="stylesheet" href="css/github.min.css">
    <link type="text/css" rel="stylesheet" href="css/default.min.css">
    <link type="text/css" rel="stylesheet" href="css/lightbox.min-0.5.1.css">
    <link type="text/css" rel="stylesheet" href="css/jquery.treemenu.css">

    
    <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/highlight-8.6.min.js"></script>
    <script type="text/javascript" src="js/lunr.min-0.5.11.js"></script>
    <script type="text/javascript" src="js/deprecated.js"></script>
    <script type="text/javascript" src="js/lightbox.min-0.5.1.js"></script>
    <script type="text/javascript" src="js/jquery.treemenu.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            // Every image referenced from a Markdown document
            $("#content img").each(function() {
                // Let's put a caption if there is one
                if($(this).attr("alt"))
                    $(this).wrap('<figure class="image"></figure>')
                        .after('<figcaption>'+$(this).attr("alt")+'</figcaption>');
                });
        });
    </script>


    <script type="text/javascript">
    hljs.initHighlightingOnLoad();
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            if(isVersionDeprecated())
                document.getElementById('deprecatedNote').style.display='block';
                document.getElementById("documentationSelect").onchange = function() {
                var selectedOption = this.value;
                 console.log(selectedOption);
                 window.top.location.href = "http://www.wikitude.com/developer/documentation/" + selectedOption;
                }
        });
    </script>

</head>
<body>
    <div id="page">
        <a name="top" />
         

<div id="sidebar">
    <div id="topnav">
    <img src="images/150610_WT_SDK_Logo.png">
    <h1><a href="">Documentation</a></h1>
    <h2>Wikitude SDK iOS</h2>
    
    <div id="version">version: 5.3.0</div>
    

    
    <select id="documentationSelect">
        
            <option value=""  > ---Android--- </option>
        
            <option value="android"  > Android Javascript API </option>
        
            <option value="androidnative"  > Android Native API </option>
        
            <option value=""  > ---iOS--- </option>
        
            <option value="ios"  selected > iOS Javascript API </option>
        
            <option value="iosnative"  > iOS Native API </option>
        
            <option value=""  > ---Extensions--- </option>
        
            <option value="phonegap"  > Cordova </option>
        
            <option value="titanium"  > Titanium </option>
        
            <option value="unity"  > Unity </option>
        
            <option value="xamarin"  > Xamarin </option>
        
            <option value=""  > ---Smart Glasses--- </option>
        
            <option value="epson"  > Epson </option>
        
            <option value="glass"  > Google Glass </option>
        
            <option value="odg"  > ODG </option>
        
            <option value="vuzix"  > Vuzix </option>
        
            <option value=""  > ---Services--- </option>
        
            <option value="cloudrecognition"  > Cloud Recognition </option>
        
            <option value="targetsapi"  > Targets API </option>
        
    </select>
    

    <div id="deprecatedNote" class="warning" style="display:none;">Note you are viewing the documentation of a deprecated version. Please check <a href="http://www.wikitude.com/developer/documentation">www.wikitude.com/developer/documentation</a></div>

    </div>

    <input id="showNav" class="toggleNav" type="checkbox">
    <label class="showNavLbl" for="showNav">Show Navigation</label>
    <label class="hideNavLbl" for="showNav">Hide Navigation</label>

    <div id="mainnav">
    <form action="search.html"><input id="search" type="text" placeholder="Search documentation" name="q" /></form>
    <nav id="toc">
        
    <ul>
    
        <li>
            <a href="gettingstartedios.html#getting-started">Getting started</a>
            
                
    <ul>
    
        <li>
            <a href="setupguideios.html#setup-guide-ios">Setup Guide iOS</a>
            
        </li>
    
        <li>
            <a href="supporteddevicesios.html#supported-devices-ios">Supported Devices iOS</a>
            
        </li>
    
        <li>
            <a href="triallicense.html#how-to-obtain-a-free-trial-license">How to obtain a free trial license</a>
            
        </li>
    
        <li>
            <a href="triallicense.html#where-should-i-enter-the-license-key">Where should I enter the license key</a>
            
        </li>
    
</ul>

            
        </li>
    
        <li>
            <a href="samples.html#examples">Examples</a>
            
                
    <ul>
    
        <li>
            <a href="clientrecognition.html#client-recognition">Client Recognition</a>
            
        </li>
    
        <li>
            <a href="cloudrecognition.html#cloud-recognition">Cloud Recognition</a>
            
        </li>
    
        <li>
            <a href="3dmodels.html#3d-models">3D Models</a>
            
        </li>
    
        <li>
            <a href="poi.html#point-of-interest-poi">Point Of Interest (POI)</a>
            
        </li>
    
        <li>
            <a href="retrievingpoidata.html#retrieving-poi-data">Retrieving POI Data</a>
            
        </li>
    
        <li>
            <a href="browsingpois.html#browsing-pois">Browsing POIs</a>
            
        </li>
    
        <li>
            <a href="video.html#video-drawables">Video Drawables</a>
            
        </li>
    
        <li>
            <a href="2dtrackingandgeo.html#combine-client-recognition-and-pois">Combine Client Recognition and POIs</a>
            
        </li>
    
        <li>
            <a href="solarsystemir.html#solar-system-ir">Solar System (IR)</a>
            
        </li>
    
        <li>
            <a href="solarsystemgeo.html#solar-system-geo">Solar System (Geo)</a>
            
        </li>
    
        <li>
            <a href="hardwarecontrol.html#hardware-control">Hardware control</a>
            
        </li>
    
        <li>
            <a href="pluginsapi.html#plugins-api">Plugins API</a>
            
        </li>
    
        <li>
            <a href="inputpluginsapi.html#input-plugins-api">Input Plugins API</a>
            
        </li>
    
        <li>
            <a href="positionable.html#positionable">Positionable</a>
            
        </li>
    
        <li>
            <a href="targetimages.html#target-images">Target Images</a>
            
        </li>
    
</ul>

            
        </li>
    
        <li>
            <a href="gettingstartedcloudrecognition.html#wikitude-cloud-recognition">Wikitude Cloud Recognition</a>
            
                
    <ul>
    
        <li>
            <a href="gettingstartedcloudrecognition.html#general-definitions">General Definitions</a>
            
        </li>
    
        <li>
            <a href="gettingstartedcloudrecognition.html#getting-started-with-the-cloud-recognition-service">Getting Started with the Cloud Recognition Service</a>
            
        </li>
    
        <li>
            <a href="gettingstartedcloudrecognition.html#authentication">Authentication</a>
            
        </li>
    
        <li>
            <a href="gettingstartedcloudrecognition.html#quota-and-limits">Quota and Limits</a>
            
        </li>
    
        <li>
            <a href="cloudrecognitionworkflow.html#your-first-target-collections">Your first Target Collections</a>
            
        </li>
    
        <li>
            <a href="cloudrecognitionworkflow.html#add-target-images">Add Target Images</a>
            
        </li>
    
        <li>
            <a href="cloudrecognitionworkflow.html#generate-a-cloud-archive">Generate a Cloud Archive</a>
            
        </li>
    
        <li>
            <a href="cloudrecognitionworkflow.html#generate-a-wtc-file">Generate a WTC file</a>
            
        </li>
    
        <li>
            <a href="cloudrecognitionworkflow.html#additional-calls">Additional calls</a>
            
        </li>
    
</ul>

            
        </li>
    
        <li>
            <a href="workflow.html#development-workflow">Development Workflow</a>
            
                
    <ul>
    
        <li>
            <a href="workflow.html#code-test-debug">Code, Test, Debug</a>
            
        </li>
    
        <li>
            <a href="workflow.html#on-device-debugging">On-Device Debugging</a>
            
        </li>
    
        <li>
            <a href="assetsworkflow.html#3d-assets-workflow">3D Assets Workflow</a>
            
        </li>
    
        <li>
            <a href="assetsworkflow.html#good-practice">Good practice</a>
            
        </li>
    
        <li>
            <a href="assetsworkflow.html#working-with-3d-animations">Working with 3D Animations</a>
            
        </li>
    
        <li>
            <a href="assetsworkflow.html#lighting">Lighting</a>
            
        </li>
    
        <li>
            <a href="workingwithvideos.html#augmented-reality-videos">Augmented reality videos</a>
            
        </li>
    
</ul>

            
        </li>
    
        <li>
            <a href="tools.html#tools">Tools</a>
            
                
    <ul>
    
        <li>
            <a href="ade.html#ade">ADE</a>
            
        </li>
    
        <li>
            <a href="logger.html#logger">Logger</a>
            
        </li>
    
        <li>
            <a href="targetmanagement.html#target-management">Target Management</a>
            
        </li>
    
        <li>
            <a href="targetmanagement.html#web-targetmanager-wikitude-studio">Web Targetmanager - Wikitude Studio</a>
            
        </li>
    
        <li>
            <a href="targetguide.html#best-practice-for-target-images">Best practice for target images</a>
            
        </li>
    
        <li>
            <a href="encoder.html#wikitude-3d-encoder">Wikitude 3D Encoder</a>
            
        </li>
    
</ul>

            
        </li>
    
        <li>
            <a href="referenceios.html#reference">Reference</a>
            
                
    <ul>
    
        <li>
            <a href="referenceios.html#ios-reference">iOS Reference</a>
            
        </li>
    
        <li>
            <a href="referenceios.html#javascript-api">JavaScript API</a>
            
        </li>
    
        <li>
            <a href="referenceios.html#cloud-recognition-manager-api">Cloud Recognition Manager API</a>
            
        </li>
    
        <li>
            <a href="sdu-dbs.html#sdu-and-dbs">SDU and DBS</a>
            
        </li>
    
</ul>

            
        </li>
    
        <li>
            <a href="migration.html#migration">Migration</a>
            
                
    <ul>
    
        <li>
            <a href="migration.html#migrate-from-52-to-53">Migrate from 5.2 to 5.3</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-50-to-52">Migrate from 5.0 to 5.2</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-41-to-50">Migrate from 4.1 to 5.0</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-41-to-411">Migrate from 4.1 to 4.1.1</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-402-to-41">Migrate from 4.0.2 to 4.1</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-40-to-402">Migrate from 4.0 to 4.0.2</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-33-to-40">Migrate from 3.3 to 4.0</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-32-to-33">Migrate from 3.2 to 3.3</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-31-to-32">Migrate from 3.1 to 3.2</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-30-to-31">Migrate from 3.0 to 3.1</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-20-to-30">Migrate from 2.0 to 3.0</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrate-from-12-to-20">Migrate from 1.2 to 2.0</a>
            
        </li>
    
        <li>
            <a href="migration.html#upgrading-targets-for-sdk-41">Upgrading targets for SDK 4.1</a>
            
        </li>
    
        <li>
            <a href="migration.html#migrating-targets-from-sdk-1x">Migrating targets from SDK 1.x</a>
            
        </li>
    
</ul>

            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-ios-release-notes">Wikitude SDK iOS Release Notes</a>
            
                
    <ul>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-530">Wikitude SDK JavaScript API 5.3.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-520">Wikitude SDK JavaScript API 5.2.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-514">Wikitude SDK JavaScript API 5.1.4</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-513">Wikitude SDK JavaScript API 5.1.3</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-512">Wikitude SDK JavaScript API 5.1.2</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-511">Wikitude SDK JavaScript API 5.1.1</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-510">Wikitude SDK JavaScript API 5.1.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-500">Wikitude SDK JavaScript API 5.0.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-411">Wikitude SDK JavaScript API 4.1.1</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-410">Wikitude SDK JavaScript API 4.1.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-402">Wikitude SDK JavaScript API 4.0.2</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-400">Wikitude SDK JavaScript API 4.0.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-332">Wikitude SDK JavaScript API 3.3.2</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-331">Wikitude SDK JavaScript API 3.3.1</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-330">Wikitude SDK JavaScript API 3.3.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-321">Wikitude SDK JavaScript API 3.2.1</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-320">Wikitude SDK JavaScript API 3.2.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-310">Wikitude SDK JavaScript API 3.1.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-300">Wikitude SDK JavaScript API 3.0.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-201">Wikitude SDK JavaScript API 2.0.1</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-200">Wikitude SDK JavaScript API 2.0.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-120">Wikitude SDK JavaScript API 1.2.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-111">Wikitude SDK JavaScript API 1.1.1</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-110">Wikitude SDK JavaScript API 1.1.0</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-105">Wikitude SDK JavaScript API 1.0.5</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-104">Wikitude SDK JavaScript API 1.0.4</a>
            
        </li>
    
        <li>
            <a href="changelog.html#wikitude-sdk-javascript-api-103">Wikitude SDK JavaScript API 1.0.3</a>
            
        </li>
    
</ul>

            
        </li>
    
</ul>

    </nav>
    
    <nav id="links">
        <ul>
            
        </ul>
    </nav>
    
    </div>
</div>
        <div id="content">
            <h2 id="input-plugins-api">Input Plugins API</h2>
<p>This guide provides an introduction into the input plugins API of the Wikitude Native SDK and aims to familiarize the reader with its concepts and constraints. Due to the length and complexity of the corresponding example application source code, it will not be presented in its entirety. Relevant and descriptive source code examples will, however, be provided. Since the Input Plugins API is an extension to the Plugins API, we recommend familiarity with it prior to reading this guide.</p>
<ol>
<li><a href="#about">About Wikitude SDK Input Plugins</a></li>
<li><a href="#base_class">Input Plugin Base Class</a></li>
<li><a href="#concurrency">Concurrency</a></li>
<li><a href="#context">OpenGL Context</a></li>
<li><a href="#orientation">Device Orientation</a></li>
</ol>
<p><a id="about"></a></p>
<h3 id="about-wikitude-sdk-input-plugins">About Wikitude SDK Input Plugins</h3>
<p>The input plugins API provides a means to alter the inputs and outputs of the Wikitude Native SDK. For the input case specifically, custom frame data of arbitrary sources can be supplied as an input to the Wikitude SDK Native API for processing. Complementary, for the output case, the default rendering of the Wikitude SDK Native API can be substituted with more advanced implementations. The custom camera example we provide illustrates both principles in a unified use case. A custom camera stream is supplied as an input and a custom rendering effect is used to augment the rendered output.</p>
<p><a id="base_class"></a></p>
<h3 id="input-plugin-base-class">Input Plugin Base Class</h3>
<pre><code>class InputPlugin: public Plugin {
public:
    using InputFrameAvailableNotifier = std::function&lt;int(long frameId, std::shared_ptr&lt;unsigned char&gt; frameData)&gt;;

public:
    InputPlugin(std::string identifier_);
    virtual ~InputPlugin();

    virtual FrameColorSpace getInputFrameColorSpace() = 0;
    virtual float getHorizontalAngle() = 0;
    virtual Size&lt;int&gt; getInputFrameSize() = 0;

    virtual bool requestsInputFrameRendering();
    virtual bool requestsInputFrameProcessing();

    void notifyNewInputFrame(long frameId_, std::shared_ptr&lt;unsigned char&gt; inputFrame_, bool managedFromOutside_ = false);

    InputFrameRenderSettings&amp; getRenderSettings();
    virtual void prepareRenderingOfInputFrame(long frameId_);

    virtual std::shared_ptr&lt;unsigned char&gt; getPresentableInputFrameData();

    virtual void internalError(const std::string&amp; errorMessage);
    void setInputFrameAvailableNotifier(InputFrameAvailableNotifier newInputFrameAvailableNotifier);

private:
    InputFrameAvailableNotifier                     _newInputFrameAvailableNotifier;

    InputFrameRenderSettings                        _renderSettings;
    std::unique_ptr&lt;InputFrameBufferController&gt;     _inputFrameBufferController;
};
</code></pre><p>The keen observer will be quick to notice that the <code>InputPlugin</code> class is derived from the <code>Plugin</code> class. This allows an <code>InputPlugin</code> to be handled in the same manner as a regular plugin; therefore <code>Plugin</code> instantiation and registration are identical and will not be discussed redundantly in this guide. Please refer to the Plugins API guide for a detailed explanation. Instead, we will focus on and demonstrate the use of the newly introduced functions.</p>
<h3 id="color-space">Color Space</h3>
<pre><code>wikitude::sdk::FrameColorSpace YUVFrameInputPlugin::getInputFrameColorSpace() {
    return wikitude::sdk::FrameColorSpace::YUV_420_NV21;
}
</code></pre><p>The <code>getInputFrameColorSpace</code> function needs to be overridden to provide a <code>FrameColorSpace</code> enumeration value. The Wikitude Native SDK currently accepts RGB frame data corresponding to the <code>FrameColorSpace::RGB</code> value, as well as YUV data in 4:2:0 NV21 format corresponding to the <code>FrameColorSpace::YUV_420_NV21</code> value. The former implies a frame data size of <code>frameWidth * frameHeight * 3</code> bytes, while the latter implies a frame data size of <code>frameWidth * frameHeight * 3 / 2</code> bytes.</p>
<h3 id="field-of-view">Field of View</h3>
<p>The <code>getHorizontalAngle</code> function needs to be overridden to provide a <code>float</code> value representing the horizontal field of view angle in degrees of the camera the provided frame was captured with. This value is required for the Wikitude computer vision engine to be able to accurately recognise and track targets within the provided frame. Note that the field of view value may significantly differ from device to device, we therefore recommend querying this value from the frame source directly to ensure representative values. For input image files and input video files this value should be discernible from the corresponding meta data; for an input camera stream this value should be accessible though the corresponding camera API.</p>
<h3 id="frame-size">Frame Size</h3>
<p>The <code>getInputFrameSize</code> function needs to be overridden to provide an object of type <code>wikitude::sdk::Size&lt;int&gt;</code> containing the input image width and input image height in pixels. Since this value will be constant for many use cases, you may consider hard-coding it to the appropriate values. Alternatively, as with the previous function, we recommend querying the values from either the input file or the input camera device.</p>
<h3 id="default-frame-rendering">Default Frame Rendering</h3>
<pre><code>bool YUVFrameInputPlugin::requestsInputFrameRendering() {
    return false;
}
</code></pre><p>The <code>requestsInputFrameRendering</code> function can be overridden to provide a boolean value indicating whether the input frame data should be processed by the Wikitude SDK Native API or not. The default implementation returns true, meaning that the frame will be rendered using the internal rendering of the Wikitude SDK Native API to present the frame. Should this function be overridden to return false, the responsibility to present the frame becomes that of the <code>InputPlugin</code>.</p>
<h3 id="default-frame-processing">Default Frame Processing</h3>
<pre><code>bool YUVFrameInputPlugin::requestsInputFrameProcessing() {
    return true;
}
</code></pre><p>The <code>requestsInputFrameProcessing</code> function can be overridden to provide a boolean value indicating whether the input frame data should be processed by the Wikitude computer vision engine. The default implementation returns <code>true</code>, meaning that it will be processed. The plugin will be notified of the recognition results through the update function, as is the case for the regular Plugins API. Should this function to be overridden to return <code>false</code>, the responsibility to perform the desired algorithms becomes that of the <code>InputPlugin</code>.</p>
<h3 id="supplying-image-data">Supplying Image Data</h3>
<pre><code>void notifyNewInputFrame(long frameId_, std::shared_ptr&lt;unsigned char&gt; inputFrame_, bool managedFromOutside_ = false);
</code></pre><p>The <code>notifyNewInputFrame</code> function needs to be called to pass the actual input frame data to the Wikitude SDK Native API. It requires a unique frame identifier of <code>long</code> type to be supplied, as well as the frame data itself wrapped into a <code>std::shared_ptr&lt;unsigned char&gt;</code>. It additionally accepts a boolean value indicating whether the default frame caching should be employed or not. The parameter value defaults to <code>false</code>, meaning the Wikitude SDK Native API default caching will be used. Should you prefer to supply your own frame caching mechanism, set this value to <code>true</code>. The default caching mechanism keeps up to 5 recent frames in memory to ensure smooth processing performance. Note that you may need to invoke this method from native code due to the file resource or input stream device only being accessible therein. For this use case we recommend having a look at the custom camera sample application code of the Wikitude Native SDK example application.</p>
<h3 id="rendering-configuration">Rendering Configuration</h3>
<pre><code>InputFrameRenderSettings&amp; getRenderSettings();
</code></pre><p>The <code>getRenderSettings</code> function behaviour can be altered to provide a parameterised instance of type InputFrameRenderSettings. The default implementation returns the default constructed <code>_renderSettings</code> member. Should you like to provide render settings to the internal Wikitude Native SDK that differ from the default constructed values, alter the <code>_renderSettings</code> accordingly before it is returned.</p>
<h3 id="frame-caching">Frame Caching</h3>
<pre><code>virtual void prepareRenderingOfInputFrame(long frameId_);
</code></pre><p>The <code>prepareRenderingOfInputFrame</code> function is called whenever a frame has been processed to report its identifier. It is, however, only called if <code>requestsInputFrameRendering</code> has been overridden to return <code>false</code> and <code>requestsInputFrameProcessing</code> has been overridden to return <code>true</code>. The default implementation of this function releases the frame indicated by the received identifier as well as any older frames from the frame cache. In case of a non-default frame caching mechanism, override this method accordingly. An input parameter of <code>-1</code> identifies the most recent frame.</p>
<h3 id="receiving-processed-frame-data">Receiving Processed Frame Data</h3>
<pre><code>virtual std::shared_ptr&lt;unsigned char&gt; getPresentableInputFrameData();
</code></pre><p>The <code>getPresentableInputFrameData</code> function can be called to receive the frame data of the most recently processed frame from the default frame cache. Use this method in case <code>requestsInputFrameRendering</code> has been overridden to return <code>false</code> in order to retrieve the current frame data to be rendered. When using a custom frame caching mechanism, this function is obsolete.</p>
<h3 id="error-handling">Error handling</h3>
<pre><code>virtual void internalError(const std::string&amp; errorMessage);
</code></pre><p>The <code>internalError</code> function gets called whenever an internal error occurs in the Wikitude Native SDK that was not directly related to input plugins. The input parameter provides a description of the error that occurred.</p>
<h3 id="internal-use-only">Internal Use Only</h3>
<pre><code>void setInputFrameAvailableNotifier(InputFrameAvailableNotifier newInputFrameAvailableNotifier);
</code></pre><p>The <code>setInputFrameAvailableNotifier</code> function is called internally and should not be called anywhere else.</p>
<p><a id="concurrency"></a></p>
<h3 id="concurrency">Concurrency</h3>
<p>When implementing an <code>InputPlugin</code>, one needs to be aware that its callback functions are invoked concurrently by the Wikitude SDK Native API. It is therefore necessary to protect against race conditions accordingly. We will present two recommended measures to do so: atomic operations and mutual exclusion.</p>
<p>In order to fully utilize the capabilities of the Input Plugin API one must gather data from several asynchronously called member functions, store them, potentially as member variables, and subsequently use them collectively. These operations might be vulnerable to race conditions.</p>
<p>An example snippet from the custom camera example application code:</p>
<pre><code>void YUVFrameInputPlugin::surfaceChanged(wikitude::sdk::Size&lt;int&gt; renderSurfaceSize_, wikitude::sdk::Size&lt;float&gt; cameraSurfaceScaling_, wikitude::sdk::DeviceOrientation deviceOrientation_) {

    // some orientation handling code here

    _surfaceInitialized.store(true);
}
</code></pre><pre><code>void YUVFrameInputPlugin::startRender() {
    // some early exit code here

    render();
}
</code></pre><pre><code>void YUVFrameInputPlugin::render() {

    // some early exit code here

    if (!_surfaceInitialized.load()) {
        return;
    }

    // lots of OpenGL code here
}
</code></pre><pre><code>#include &lt;atomic&gt;

std::atomic_bool _surfaceInitialized;
</code></pre><p>The <code>surfaceChanged</code> function and the <code>startRender</code> function are invoked concurrently. We rely on a boolean value inside the render function that is set from the <code>surfaceChanged</code> function, yielding a race condition should boolean reads and writes be non-atomic. In such cases, involving intrinsic data types for which atomic operations are provided by the C++ standard library, we recommend their use. These <code>std::atomics</code> can either be set and read intuitively through the corresponding operators or though the <code>load</code> and <code>store</code> functions.</p>
<p>An alternative snippet for which atomic operations are not available:</p>
<pre><code>void YUVFrameInputPlugin::update(const std::list&lt;wikitude::sdk::RecognizedTarget&gt;&amp; recognizedTargets_) {
    // platform specific intialization code here

    { // mutex auto release scope
        std::lock_guard&lt;std::mutex&gt; lock(_currentlyRecognizedTargetsMutex);
        _currentlyRecognizedTargets = std::list&lt;wikitude::sdk::RecognizedTarget&gt;(recognizedTargets_);
    }
}
</code></pre><pre><code>void YUVFrameInputPlugin::startRender() {
    // some early exit code here

    render();
}
</code></pre><pre><code>void YUVFrameInputPlugin::render() {
    // early returns and lots of OpenGL code here

    { // mutex auto release scope
    std::unique_lock&lt;std::mutex&gt; lock(_currentlyRecognizedTargetsMutex);

        if (!_currentlyRecognizedTargets.empty()) {
            const wikitude::sdk::RecognizedTarget targetToDraw = _currentlyRecognizedTargets.front();

            // early unlock to minimize locking duration
            lock.unlock();

            // lots of OpenGL code here
        }
    }
}
</code></pre><p>The <code>update</code> function and the <code>startRender</code> function are invoked concurrently. We, again, rely on data being set from an asynchronous function within our render function. Contrary to the previous case though, an object of type <code>std::list</code> cannot be set atomically using <code>std::atomics</code>. Therefore we employ a <code>std::mutex</code> as a locking mechanism to ensure atomicity. As depicted by the code snippet, we encourage the use of RAII style mutex locking using <code>std::lock_guard</code> and <code>std::unique_lock</code> to ensure proper mutex release.</p>
<p><a id="context"></a></p>
<h3 id="opengl-context">OpenGL Context</h3>
<p>Another important issue to be aware of is the availability of a valid OpenGL context during plugin run-time. We guarantee such a valid context to be available during the execution of the <code>startRender</code>, <code>endRender</code>, <code>pause</code> and <code>resume</code> functions. The former two functions should contain all of the rendering related function calls, while the latter should be used to release and acquire OpenGL related resources as the OpenGL context is likely to be destroyed upon pausing the application and recreated upon resuming the application. Therefore all the previously acquired OpenGL handles are no longer valid and need to be reacquired.</p>
<p>A code snipped from the custom camera example:</p>
<pre><code>void YUVFrameInputPlugin::pause() {

    releaseFramebufferObject();
    releaseFrameTextures();
    releaseVertexBuffers();
    releaseShaderProgram();

    _renderingInitialized.store(false);

    // some additional code here
}
</code></pre><pre><code>void YUVFrameInputPlugin::startRender() {
    if (!_renderingInitialized.load()) {
        _renderingInitialized.store(setupRendering());
    }

    render();
}
</code></pre><p>We release all the OpenGL resources we previously created and atomically set the <code>_renderingInitialized</code> flag to <code>false</code>, causing the rendering environment to be reinitialised during the next execution of the render loop.</p>
<p><a id="orientation"></a></p>
<h3 id="device-orientation">Device Orientation</h3>
<p>Lastly, we will demonstrate the rendering of an input frame from within an <code>InputPlugin</code> using OpenGL with device orientations taken into account. While there are alternative ways to achieve the correctly oriented frame renderings, we recommend applying the required transformations as matrices within a custom vertex shader.</p>
<p>We propose the following code in our custom camera example application to compose a matrix that is to be applied to a fullscreen quad:</p>
<pre><code>void YUVFrameInputPlugin::surfaceChanged(wikitude::sdk::Size&lt;int&gt; renderSurfaceSize_, wikitude::sdk::Size&lt;float&gt; cameraSurfaceScaling_, wikitude::sdk::DeviceOrientation deviceOrientation_) {
    wikitude::sdk::Matrix4 scaleMatrix;
    scaleMatrix.scale(cameraSurfaceScaling_.width, cameraSurfaceScaling_.height, 1.0f);

    switch (deviceOrientation_)
    {
        case wikitude::sdk::DeviceOrientation::DeviceOrientationPortrait:
        {
            wikitude::sdk::Matrix4 rotationToPortrait;
            rotationToPortrait.rotateZ(270.0f);

            _orientationMatrix = rotationToPortrait;
            break;
        }
        case wikitude::sdk::DeviceOrientation::DeviceOrientationPortraitUpsideDown:
        {
            wikitude::sdk::Matrix4 rotationToUpsideDown;
            rotationToUpsideDown.rotateZ(90.0f);

            _orientationMatrix = rotationToUpsideDown;
            break;
        }
        case wikitude::sdk::DeviceOrientation::DeviceOrientationLandscapeLeft:
        {
            wikitude::sdk::Matrix4 rotationToLandscapeLeft;
            rotationToLandscapeLeft.rotateZ(180.0f);

            _orientationMatrix = rotationToLandscapeLeft;
            break;
        }
        case wikitude::sdk::DeviceOrientation::DeviceOrientationLandscapeRight:
        {
            _orientationMatrix.identity();
            break;
        }
    }

    _modelMatrix = scaleMatrix * _orientationMatrix;

    // some synchronization code here
}
</code></pre><pre><code>attribute vec3 vPosition;
attribute vec2 vTexCoords;

varying mediump vec2 fTexCoords;

uniform mat4 uModelMatrix;

void main(void)
{
    gl_Position = uModelMatrix * vec4(vPosition, 1.0);
    fTexCoords = vTexCoords;
}&quot;;
</code></pre><pre><code>struct Vertex
{
    GLfloat position[3];
    GLfloat texCoord[2];
};

Vertex _vertices[4];
</code></pre><pre><code>_vertices[0] = (Vertex){{1.0f, -1.0f, 0}, {1.0f, 0.0f}};
_vertices[1] = (Vertex){{1.0f, 1.0f, 0}, {1.0f, 1.0f}};
_vertices[2] = (Vertex){{-1.0f, 1.0f, 0}, {0.0f, 1.0f}};
_vertices[3] = (Vertex){{-1.0f, -1.0f, 0}, {0.0f, 0.0f}};
</code></pre><p>The matrix composed within the <code>surfaceChanged</code> function is supplied to the vertex shader as a <code>uniform</code> parameter and subsequently used to transform the input vertices. Be aware though, that an additional matrix may be required depending on whether you previously rendered to a FBO. If so, the following amendment to the <code>surfaceChanged</code> function should correct the flipped Y-axis resulting from this process:</p>
<pre><code>wikitude::sdk::Matrix4 scaleMatrix;
_fboCorrectionMatrix.scale(1.0f, -1.0f, 1.0f);

// same device orientation code here as depicted above

_modelMatrix = scaleMatrix * _orientationMatrix * _fboCorrectionMatrix;
</code></pre><p>For a complete implementation of an input plugin for a specific and advanced use case, we strongly recommend looking into the custom camera example application source code. Additionally, the custom camera sample source code is an excellent starting point to build your own implementation from.</p>

            <footer id="footer">
                &copy; 2012 -2016 <a href="http://www.wikitude.com">Wikitude GmbH</a> Â· <a href="http://www.wikitude.com/imprint">Imprint</a>
            </footer>  
        </div>    
    </div>

    <!-- TO DO: Reactivate when problems with nav are fixed
    <script>
    $(function(){
            $("#toc ul").treemenu({delay:300}).openActive();
        });
    </script>
    -->

</body>
    <script>
    var lightbox = new Lightbox();
    lightbox.load();
    </script>

</html>
